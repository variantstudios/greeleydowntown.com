var L=require("leaflet"),Util=require("../util");module.exports={"class":L.Class.extend({options:{serviceUrl:"//nominatim.openstreetmap.org/",geocodingQueryParams:{},reverseQueryParams:{},htmlTemplate:function(t){var e=t.address,o=[];return(e.road||e.building)&&o.push("{building} {road} {house_number}"),(e.city||e.town||e.village||e.hamlet)&&o.push('<span class="'+(o.length>0?"leaflet-control-geocoder-address-detail":"")+'">{postcode} {city} {town} {village} {hamlet}</span>'),(e.state||e.country)&&o.push('<span class="'+(o.length>0?"leaflet-control-geocoder-address-context":"")+'">{state} {country}</span>'),Util.template(o.join("<br/>"),e,!0)}},initialize:function(t){L.Util.setOptions(this,t)},geocode:function(t,e,o){Util.jsonp(this.options.serviceUrl+"search",L.extend({q:t,limit:5,format:"json",addressdetails:1},this.options.geocodingQueryParams),function(t){for(var n=[],s=t.length-1;s>=0;s--){for(var a=t[s].boundingbox,l=0;l<4;l++)a[l]=parseFloat(a[l]);n[s]={icon:t[s].icon,name:t[s].display_name,html:this.options.htmlTemplate?this.options.htmlTemplate(t[s]):void 0,bbox:L.latLngBounds([a[0],a[2]],[a[1],a[3]]),center:L.latLng(t[s].lat,t[s].lon),properties:t[s]}}e.call(o,n)},this,"json_callback")},reverse:function(t,e,o,n){Util.jsonp(this.options.serviceUrl+"reverse",L.extend({lat:t.lat,lon:t.lng,zoom:Math.round(Math.log(e/256)/Math.log(2)),addressdetails:1,format:"json"},this.options.reverseQueryParams),function(t){var e,s=[];t&&t.lat&&t.lon&&(e=L.latLng(t.lat,t.lon),s.push({name:t.display_name,html:this.options.htmlTemplate?this.options.htmlTemplate(t):void 0,center:e,bounds:L.latLngBounds(e,e),properties:t})),o.call(n,s)},this,"json_callback")}}),factory:function(t){return new L.Control.Geocoder.Nominatim(t)}};